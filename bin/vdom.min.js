let vComponents={},makePath=function(e){const t=[];for(;e.parentNode;e=e.parentNode){const n=e.parentNode.children;if(1==n.length){t.unshift(e.nodeName);continue}let o=-1,i=0;for(const t of n)e.nodeName==t.nodeName&&(i++,e==t&&(o=i-1));let r=e.nodeName;i>1&&(r+="["+o+"]"),t.unshift(r)}return"/"+t.join("/")},delay=function(e,t){let n=0;return function(...o){clearTimeout(n),n=setTimeout(e.bind(this,...o),t||0)}};class Values{static isNumber(e){return"number"==typeof e}static isBoolean(e){return"boolean"==typeof e}static isString(e){return"string"==typeof e}static isDate(e){return"[object Date]"==toString.call(e)}static toNumber(e,t){return null==e?t:(e=Number(e),isNaN(e)?t:e)}static toBoolean(e,t){if(null==e)return t;if("boolean"==typeof e)return e;if("number"==typeof e)return 0!=e;if("string"==typeof e)try{return 1==JSON.parse(e.toLowerCase())}catch(e){}return t}static toString(e,t){if(null==e)return t;if("string"==typeof e)return e;try{return e.toString()}catch(e){}return t}static trim(e){return Values.toString(e,"").trim()}static toDate(e,t){if(null==e)return t;if("[object Date]"==toString.call(e))return e;try{return new Date(e)}catch(e){}return t}static hashCode(e){if(null!=e)return 0==(e=JSON.stringify(e)).length?0:e.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0)}static toISODateString(e){try{return Values.isDate(e)||(e=new Date(e)),e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)}catch(e){}return""}static toISOTimeString(e){try{return Values.isDate(e)||(e=new Date(e)),("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}catch(e){}return""}static toISODateTimeString(e){try{return Values.isDate(e)||(e=new Date(e)),e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"T"+("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2)}catch(e){}return""}static clone(e,t){return null==e?t:null!=(e=JSON.parse(JSON.stringify(e)))?e:t}}class VModels{static toValue(e,t){return-1!=e.vModelModifiers.indexOf("number")?Values.toNumber(t):-1!=e.vModelModifiers.indexOf("date")||-1!=e.vModelModifiers.indexOf("datetime")?Values.toDate(t):-1!=e.vModelModifiers.indexOf("time")?Values.toDate("1970-01-01T"+t):-1!=e.vModelModifiers.indexOf("boolean")?Values.toBoolean(t):Values.toString(t)}static toString(e,t){return-1!=e.vModelModifiers.indexOf("date")?Values.toISODateString(t):-1!=e.vModelModifiers.indexOf("time")?Values.toISOTimeString(t):-1!=e.vModelModifiers.indexOf("datetime")?Values.toISODateTimeString(t):Values.toString(t)}}class VForExpression{constructor(e,t){let n=this;if(n.$vNode=e,""==(t=Values.toString(t,"").trim()))throw new Error("The expression must be specified.");n.$source=t;let o,i=t;if(i.startsWith("(")){let e=i.match(/\(.*\)/);if(!e)throw new Error("Syntax error: "+n.$source);e=e[0],o=i.substring(e.length).trim(),i=e}else if(i.startsWith("{")){let e=i.match(/\{.*\}/);if(!e)throw new Error("Syntax error: "+n.$source);e=e[0],o=i.substring(e.length).trim(),i=e}else if(i.startsWith("[")){let e=i.match(/\[.*\]/);if(!e)throw new Error("Syntax error: "+n.$source);e=e[0],o=i.substring(e.length).trim(),i=e}else{let e=i.split(/\s/);if(e.length<3)throw new Error("Syntax error: "+n.$source);e=e[0],o=i.substring(e.length).trim(),i=e}const r=o.split(/\s/);if(r.length<2||-1==["of","in"].indexOf(r[0]))throw new Error("Syntax error: "+n.$source);let s;o=" "+o;let a=[];if(i.startsWith("(")){let e;if(i=i.substring(1,i.length-1).trim(),i.startsWith("{")){if(e=i.match(/\{.*\}/),!e)throw new Error("Syntax error: "+n.$source)}else if(i.startsWith("[")&&(e=i.match(/\[.*\]/),!e))throw new Error("Syntax error: "+n.$source);if(e){o=e+o,a.push(...e.substring(1,e.length-1).trim().split(/\s*,\s*/));let t=i.substring(e.length).trim();if(t.length>0){if(","==t||!t.startsWith(","))throw new Error("Syntax error: "+n.$source);s=t.substring(1).trim()}}else{if(e=i.split(/\s*,\s*/),0==e.length)throw new Error("Syntax error: "+n.$source);o=e[0]+o,a.push(e[0]),e.length>1&&(s=e[1])}}else i.startsWith("{")||i.startsWith("[")?(o=i+o,a.push(...i.substring(1,i.length-1).trim().split(/\s*,\s*/))):(o=i+o,a.push(i));for(const e of a.concat([s]))if(null!=e&&e.split(/\s/).length>1)throw new Error("Syntax error: "+n.$source);n.$expression=o,n.$variables=a,n.$indexVariable=s}execute(e){let t=this.$vNode.$vApp,n=this.$vNode,o=this,i="(function() {";i+="let $index = -1;",i+="for (const "+o.$expression+") {",i+="$index++;",i+="const $bindings = {};";for(const e of o.$variables)i+="$bindings['"+e+"'] = "+e+";";null!=o.$indexVariable&&(i+="$bindings['"+o.$indexVariable+"'] = $index;"),i+="$function($bindings);",i+="}",i+="})()";let r={};if(n.$bindings)for(const[e,t]of Object.entries(n.$bindings))r[e]=t;r.$function=e,t.eval(i,r)}}class VIfStatus{constructor(){this.clear()}get canIf(){return!0}get canElseIf(){return"v-if"==this.$executed||"v-else-if"==this.$executed}get canElse(){return"v-if"==this.$executed||"v-else-if"==this.$executed}get condition(){return this.$condition}markTruthy(e){this.$executed=e,this.$condition=!0}markFalsy(e){this.$executed=e,this.$condition=!1}done(){this.clear()}clear(){this.$executed=void 0,this.$condition=!1}}class VRenderContext{constructor(){this.clearIfStatus()}get ifStatus(){return this.$ifStatus}clearIfStatus(){this.$ifStatus=new VIfStatus}}class VEventHandler{constructor(e,t){let n=this,o=e.split(".");if(n.$type=o[0],o.splice(0,1),n.$modifiers=o,n.$expression=Values.toString(t,"").trim(),""==n.$type)throw Error("The event type must be specified.")}get type(){return this.$type}get modifiers(){return this.$modifiers}get lifecycleEvents(){return["bind","bound","unbind","unbound","updated"]}get isLifecycleEvent(){return-1!=this.lifecycleEvents.indexOf(this.type)}register(e){let t=this;return t.$vNode=e,t.$eventListener=function(n){let o,i=t.$vNode.$vApp,r={event:n,vNode:e};for(const e of t.$modifiers)"stop"==e?n.stopPropagation():"prevent"==e&&n.preventDefault();if(""!=t.$expression){if("object"==typeof i.$instance.methods&&(o=i.$instance.methods[t.$expression]),"function"!=typeof o&&(o=i.eval(t.$expression,r,!0)),"function"==typeof o)try{o=o.apply(i,[n,e])}catch(e){i.log.error(e)}o instanceof Promise&&o.then((function(){i.commit()})),i.commit()}},t.$vNode.$node.addEventListener(t.type,t.$eventListener),t}unregister(){let e=this;null!=e.$eventListener&&(e.$vNode.$node.removeEventListener(e.type,e.$eventListener),e.$eventListener=void 0)}}class VNode{constructor({node:e,parentVNode:t,vApp:n,bindings:o}){let i=this;if(i.$node=e,i.$parentVNode=t,i.$nodeType=e.nodeType,i.$isReactive=!1,i.$isComponent=!1,i.$vApp=n,i.$bindings=o?Values.clone(o):{},i.$node.nodeType==Node.ELEMENT_NODE){i.$nodeName=i.$node.nodeName,i.$attributes={},i.$childVNodes=[],i.$childVNodeMap={},i.$eventHandlers=[],i.$isBound=!1;let e=!1;if(null!=i.$node.getAttribute("v-for")){const t="v-for",n=i.$node.getAttribute(t);i.$attributes[t]=n,i.$isReactive=!0,i.$node.removeAttribute(t),e=!0;for(const e of[":key"])i.$node.hasAttribute(e)&&(i.$attributes[e]=i.$node.getAttribute(e),i.$node.removeAttribute(e));if(null==i.$attributes[":key"])throw Error(":key must be specified.")}{const t=[];for(const n of["v-if","v-else-if","v-else"]){const o=i.$node.getAttribute(n);if(null!=o){if(t.push(n),t.length>1)throw Error(t[0]+" and "+t[1]+" cannot be used on the same element.");i.$attributes[n]=o,i.$isReactive=!0,i.$node.removeAttribute(n),e=!0}}}if(e){if("template"!=i.$node.nodeName.toLowerCase()){i.$templateNodeName=i.$node.nodeName,i.$template=i.$node.outerHTML;let e=document.createComment("template");i.$node.parentNode.insertBefore(e,i.$node),i.$node.parentNode.removeChild(i.$node),i.$node=e,i.$nodeType=e.nodeType}}else for(const e of i.$node.getAttributeNames())i.$attributes[e]=i.$node.getAttribute(e),e.startsWith(":")?(i.$isReactive=!0,i.$node.removeAttribute(e)):e.startsWith("@")?i.$node.removeAttribute(e):("v-component"==e||e.startsWith("v-component."))&&(i.$isComponent=!0,i.$isActivated=!1);if(!e)for(const e of i.$node.childNodes)i.$childVNodes.push(new VNode({node:e,parentVNode:i,vApp:n,bindings:i.$bindings}))}else i.$node.nodeType==Node.TEXT_NODE?(i.$nodeValue=i.$node.nodeValue,/{{.*?}}/.test(i.$node.nodeValue)&&(i.$isReactive=!0)):i.$nodeValue=i.$node.nodeValue}get vApp(){return this.$vApp}get node(){return this.$node}get nodePath(){return makePath(this.$node)}get parent(){return this.$parentVNode}get isComponent(){return this.$isComponent}get isTemplated(){return null!=this.$template}get isTemplateElement(){return this.$nodeType==Node.ELEMENT_NODE&&"template"==this.$node.nodeName.toLowerCase()}get isReactive(){return this.$isReactive}get isBound(){return this.$isBound}get vModel(){let e=this;if(e.$nodeType==Node.ELEMENT_NODE){if(null==e.$vModel){let t=Values.trim(e.$attributes["v-model"]).split(".");t.length>0?e.$vModel=t[0]:e.$vModel=""}if(""!=e.$vModel)return e.$vModel}}get vModelModifiers(){let e=this;if(e.$nodeType==Node.ELEMENT_NODE){if(null==e.$vModelModifiers){let t=Values.trim(e.$attributes["v-model"]).split(".");t.length>0&&t.shift(),e.$vModelModifiers=t}return e.$vModelModifiers}}get hasVModel(){return null!=this.vModel}get isRoot(){return null==this.$parentVNode}get root(){for(let e=this;e;e=e.$parentVNode)if(e.isRoot)return e}findParent(e){let t=this;e=e.toLowerCase();for(let n=t.$parentVNode;n;n=n.$parentVNode)if(n.$nodeName.toLowerCase()==e)return n}on(e){let t=this.$vApp,n=this;for(const o of Object.keys(n.$attributes))if(o=="@"+e){let e,i=n.$attributes[o];if(""==i)return;if("object"==typeof t.$instance.methods&&(e=t.$instance.methods[i]),"function"!=typeof e&&(e=t.eval(i,n.$bindings,!0)),"function"==typeof e)try{e=e.apply(t,[n])}catch(e){t.log.error(e)}e instanceof Promise?e.then((function(){t.commit()})):t.commit();break}}bind(){let e=this.$vApp,t=this;if(!t.$isBound&&!t.isComponent&&t.$nodeType==Node.ELEMENT_NODE&&"template"!=t.$node.nodeName.toLowerCase()){t.on("bind"),t.hasVModel&&(null==t.$updateListener&&(t.$updateListener=function(){t.update()&&(t.on("updated"),e.commit())}),"input"==t.$nodeName.toLowerCase()||"textarea"==t.$nodeName.toLowerCase()?(t.$node.addEventListener("change",t.$updateListener),t.$node.addEventListener("keyup",delay(t.$updateListener,e.keyupDelayTime))):"select"==t.$nodeName.toLowerCase()&&t.$node.addEventListener("change",t.$updateListener));for(const e of Object.keys(t.$attributes))if(e.startsWith("@")){let n=e.substring(1),o=new VEventHandler(n,t.$attributes[e]);if(o.isLifecycleEvent)continue;t.$eventHandlers.push(o.register(t))}t.$isBound=!0,t.on("bound")}}unbind(){let e=this;if(!e.isComponent&&e.$nodeType==Node.ELEMENT_NODE&&"template"!=e.$node.nodeName.toLowerCase()){if(e.on("unbind"),e.$eventHandlers){for(const t of e.$eventHandlers)t.unregister();e.$eventHandlers=[]}null!=e.$updateListener&&(e.$node.removeEventListener("change",e.$updateListener),e.$node.removeEventListener("keyup",delay),e.$updateListener=void 0),e.$isBound=!1,e.on("unbound")}}update(){let e=this.$vApp,t=this;if(!t.hasVModel)return;let n,o=e[t.vModel];if("input"==t.$nodeName.toLowerCase()){let e=Values.toString(t.$node.type,"").toLowerCase();if(-1!=["checkbox"].indexOf(e)){n=Values.clone(o),null==n?n=[]:Array.isArray(n)||(n=[n]);let e=VModels.toValue(t,t.$node.value),i=n.indexOf(e);t.$node.checked?-1==i&&n.push(e):-1!=i&&n.splice(i,1)}else n=VModels.toValue(t,t.$node.value)}else if("textarea"==t.$nodeName.toLowerCase())n=VModels.toValue(t,t.$node.value);else if("select"==t.$nodeName.toLowerCase())if(t.$node.multiple){n=[];for(const e of t.$node.selectedOptions){let o=VModels.toValue(t,e.value);-1==n.indexOf(o)&&n.push(o)}}else n=VModels.toValue(t,t.$node.value);return JSON.stringify(o)!=JSON.stringify(n)&&(e[t.vModel]=n,!0)}render(e){let t=this.$vApp,n=this;if(n.parent&&n.parent.$bindings&&n.$bindings)for(const[e,t]of Object.entries(n.parent.$bindings))n.$bindings[e]=t;if(n.isComponent){if(n.$isActivated)return void n.$componentVApp.commit(n.$bindings);let e,o,i,r,s,a;for(const[t,l]of Object.entries(n.$attributes))"v-component"==t||t.startsWith("v-component.")?(e=Values.trim(t).split("."),o=Values.trim(l)):"v-template"==t||t.startsWith("v-template.")?(i=Values.trim(t).split("."),r=Values.trim(l)):("v-properties"==t||t.startsWith("v-properties."))&&(s=Values.trim(t).split("."),a=Values.trim(l));-1!=e.indexOf("static")?n.$componentID=o:n.$componentID=t.eval(o,n.$bindings);const l=VDOM.getComponent(n.$componentID);if(null!=i&&(-1!=i.indexOf("static")?n.$templateID=r:n.$templateID=t.eval(r,n.$bindings)),null==n.$templateID){Values.trim(l.templateID).length>0&&(n.$templateID=l.templateID)}null==n.$templateID&&(n.$templateID=l.id);let d={};if(null!=a){let e=t.eval(a,n.$bindings);"object"==typeof e&&(d=e)}let u=document.querySelector("#"+n.$templateID).content.cloneNode(!0);for(const e of u.childNodes){if(e.nodeType!=Node.ELEMENT_NODE)continue;n.$node.parentNode.insertBefore(e,n.$node),n.$node.parentNode.removeChild(n.$node),n.$node=e,n.$nodeType=e.nodeType;let t=l.createInstance(d);n.$componentVApp=new VApp(n.$node,t),n.$isActivated=!0,n.$componentVApp.init(n.$bindings);break}}else{if(n.isRoot){if(n.$renderedHashCode===t.$state.hashCode)return;n.$renderedHashCode=t.$state.hashCode,e=new VRenderContext}if(n.$isReactive)if(n.$nodeType!=Node.ELEMENT_NODE||n.isTemplateElement)if(n.$nodeType==Node.TEXT_NODE){if("textarea"!=n.$parentVNode.$nodeName.toLowerCase()){let e=n.$nodeValue.replaceAll(/{{.*?}}/g,(function(e){return Values.toString(t.eval(e.substring(2,e.length-2),n.$bindings),"")}));n.$node.nodeValue!=e&&(n.$node.nodeValue=e)}}else(n.$nodeType==Node.COMMENT_NODE||n.isTemplateElement)&&n.renderTemplate(e);else for(const e of Object.keys(n.$attributes))if(":key"!=e&&e.startsWith(":")){let o=e.substring(1),i=t.eval(n.$attributes[e],n.$bindings);if("class"==o){if("object"!=typeof i)continue;let e=[],t=[];const o=n.$node.classList;for(const[n,r]of Object.entries(i))for(const i of n.split(/\s/))r?o.contains(i)||e.push(i):o.contains(i)&&t.push(i);t.length>0&&o.remove(...t),e.length>0&&o.add(...e);continue}if("style"==o){if("object"!=typeof i)continue;const e=n.$node.style;for(const[t,n]of Object.entries(i))e[t]!=n&&(e[t]=n);continue}n.$node.getAttribute(o)!=i&&n.$node.setAttribute(o,i)}if(n.$nodeType==Node.ELEMENT_NODE&&!n.isTemplateElement&&(n.hasVModel||"option"==n.$nodeName.toLowerCase()))if("input"==n.$nodeName.toLowerCase()){let e=Values.toString(n.$node.type,"").toLowerCase();if(-1!=["checkbox"].indexOf(e)){let e=t[n.vModel];null==e?e=[]:Array.isArray(e)||(e=[e]);let o=-1!=e.indexOf(VModels.toValue(n,n.$node.value));n.$node.checked!=o&&(n.$node.checked=o)}else if(-1!=["radio"].indexOf(e)){let e=t[n.vModel]==VModels.toValue(n,n.$node.value);n.$node.checked!=e&&(n.$node.checked=e)}else{let e=VModels.toString(n,t[n.vModel]);n.$node.value!=e&&(n.$node.value=e)}}else if("textarea"==n.$nodeName.toLowerCase()){let e=VModels.toString(n,t[n.vModel]);n.$node.value!=e&&(n.$node.value=e)}else if("select"==n.$nodeName.toLowerCase());else if("option"==n.$nodeName.toLowerCase()){let e=n.findParent("select");if(e&&e.hasVModel)if(e.$node.multiple){let o=t[e.vModel];null==o?o=[]:Array.isArray(o)||(o=[o]);let i=-1!=o.indexOf(VModels.toValue(n,n.$node.value));n.$node.selected!=i&&(n.$node.selected=i)}else{let o=t[e.vModel]==VModels.toValue(n,n.$node.value);n.$node.selected!=o&&(n.$node.selected=o)}}if(n.bind(),n.$nodeType==Node.ELEMENT_NODE){e.ifStatus.clear();for(const t of n.$childVNodes)t.render(e)}}}renderTemplate(e){let t=this.$vApp,n=this;if(!n.isTemplated&&!n.isTemplateElement)return;let o=n.$attributes["v-if"],i=n.$attributes["v-else-if"],r=n.$attributes["v-else"],s=n.$attributes["v-for"],a=n.$attributes[":key"];if(null==s)if(null!=o||null!=i||null!=r){let s,a;if(null!=o){if(!e.ifStatus.canIf)return void t.log.error("The v-if clause cannot be executed.");e.ifStatus.clear(),s=o,a="v-if"}if(null!=i){if(!e.ifStatus.canElseIf)return void t.log.error("The v-else-if clause cannot be executed.");s=i,a="v-else-if"}if(null!=r){if(!e.ifStatus.canElse)return void t.log.error("The v-else clause cannot be executed.");s=r,a="v-else"}let l=!1;if(e.ifStatus.condition||(l=-1==["v-if","v-else-if"].indexOf(a)||Values.toBoolean(t.eval(s,n.$bindings),!1)),l)if(n.$childVNodes.length>0)for(const t of n.$childVNodes)t.render(e);else{let t=n.createTemplateNode();if(t instanceof DocumentFragment){let e=[];for(const n of t.childNodes)e.push(n);t=e}else t=[t];for(const o of t){n.$node.parentNode.insertBefore(o,n.$node);let t=new VNode({node:o,parentVNode:n.$parentVNode,vApp:n.$vApp,bindings:n.$bindings});n.$childVNodes.push(t),t.render(e)}}else if(n.$childVNodes.length>0){for(const e of n.$childVNodes)e.remove();n.$childVNodes=[]}e.ifStatus.condition||(-1!=["v-if","v-else-if"].indexOf(a)?l?e.ifStatus.markTruthy(a):e.ifStatus.markFalsy(a):e.ifStatus.done())}else e.ifStatus.clear();else{let l=new VForExpression(n,s),d=[],u={};l.execute((function(s){let l=Values.toString(t.eval(a,s));if(null==l)return void t.log.error("Invalid key expression.");if(null!=o||null!=i||null!=r){let n,a;if(null!=o){if(!e.ifStatus.canIf)return void t.log.error("The v-if clause cannot be executed.");e.ifStatus.clear(),n=o,a="v-if"}if(null!=i){if(!e.ifStatus.canElseIf)return void t.log.error("The v-else-if clause cannot be executed.");n=i,a="v-else-if"}if(null!=r){if(!e.ifStatus.canElse)return void t.log.error("The v-else clause cannot be executed.");n=r,a="v-else"}let l=!1;if(e.ifStatus.condition||(l=-1==["v-if","v-else-if"].indexOf(a)||Values.toBoolean(t.eval(n,s),!1)),e.ifStatus.condition||(-1!=["v-if","v-else-if"].indexOf(a)?l?e.ifStatus.markTruthy(a):e.ifStatus.markFalsy(a):e.ifStatus.done()),!l)return}else e.ifStatus.clear();let c=n.$childVNodeMap[l];if(null!=c){u[l]=[];for(const t of c){d.push(t),u[l].push(t);for(const[e,n]of Object.entries(s))t.$bindings[e]=n;t.render(e)}return void delete n.$childVNodeMap[l]}let f=n.createTemplateNode();if(f instanceof DocumentFragment){let e=[];for(const t of f.childNodes)e.push(t);f=e}else f=[f];u[l]=[];for(const t of f){n.$node.parentNode.insertBefore(t,n.$node),t.nodeType==Node.ELEMENT_NODE&&t.setAttribute(":key",n.$attributes[":key"]);let o=new VNode({node:t,parentVNode:n.$parentVNode,vApp:n.$vApp,bindings:s});d.push(o),u[l].push(o),o.render(e)}}));for(const e of Object.values(n.$childVNodeMap))for(const t of e)t.remove();n.$childVNodes=d,n.$childVNodeMap=u;let c=n.$node;for(const e of n.$childVNodes)e.$node.parentNode.insertBefore(e.$node,c.nextSibling),c=e.$node}}createTemplateNode(){let e=this;if("template"==e.$node.nodeName.toLowerCase())return e.$node.content.cloneNode(!0);let t=e.$template;-1!=["thead","tbody","tr","th","td"].indexOf(Values.toString(e.$templateNodeName,"").toLowerCase())&&(t="<table>"+t+"</table>");return document.createRange().createContextualFragment(t).querySelector(e.$templateNodeName)}remove(){let e=this;if(e.$childVNodes)for(const t of e.$childVNodes)t.remove();e.isComponent?e.$isActivated&&e.$vApp.remove():(e.unbind(),e.$node.parentNode.removeChild(e.$node),delete e.$node)}static create({node:e,vApp:t}){return new VNode({node:e,vApp:t})}}class VLog{constructor(e){this.$vApp=e}debug(e){let t=this.$vApp;["debug"].indexOf(t.logLevel)}info(e){let t=this.$vApp;["debug","info"].indexOf(t.logLevel)}warn(e){let t=this.$vApp;["debug","info","warn"].indexOf(t.logLevel)}error(e){let t=this.$vApp;["debug","info","warn","error"].indexOf(t.logLevel)}}class VApp{constructor(e,t){let n=this;n.$log=new VLog(n),n.$node=e,n.$instance=t,n.$state={names:[],values:[],hashCode:void 0}}get appPath(){if(this.$node)return makePath(this.$node)}get keyupDelayTime(){return Values.toNumber(this.$instance.keyupDelayTime,400)}get logLevel(){let e=(""+this.$instance.logLevel).toLowerCase();if(-1!=["debug","info","warn","error"].indexOf(e))return e}get log(){return this.$log}init(e){let t=this;if(null!=t.$instance.methods){if("object"!=typeof t.$instance.methods)throw Error("The methods attribute must be an object.");for(const[e,n]of Object.entries(t.$instance.methods))"function"==typeof n&&(t[e]=n)}if(null!=t.$instance.data){if("function"!=typeof t.$instance.data)throw Error("The data attribute must be a function.");let e=t.$instance.data();"object"!=typeof e&&t.log.error("The data function must return an object.");for(const[n,o]of Object.entries(e))t[n]=o}const n=function(){if(t.$vNode=VNode.create({node:t.$node,vApp:t}),"object"==typeof e)for(const[n,o]of Object.entries(e))t.$vNode.$bindings[n]=o;t.compute(),t.render(),"function"==typeof t.$instance.mounted&&t.$instance.mounted.apply(t)};if("function"==typeof t.$instance.created){const e=t.$instance.created.apply(t);if(e instanceof Promise)return void e.then((function(){n()}))}n()}remove(){this.$vNode.remove()}compute(){let e=this;if("object"==typeof e.$instance.computed)for(const[t,n]of Object.entries(e.$instance.computed))e[t]=n.call(e);e.$state.data={};let t={names:[],values:[]};for(const n of Object.keys(e).sort()){if(n.startsWith("$"))continue;const o=e[n];"function"!=typeof o&&(e.$state.data[n]=o,t.names.push(n),t.values.push(o))}e.$state.hashCode=Values.hashCode(t)}render(){this.$vNode.render()}eval(e,t,n){let o=this;try{let i=[],r=[];if(t)for(const[e,n]of Object.entries(t))-1==i.indexOf(e)&&(i.push(e),r.push(n));for(const[e,t]of Object.entries(o.$state.data))-1==i.indexOf(e)&&(i.push(e),r.push(t));if("object"==typeof o.$instance.methods)for(const[e,t]of Object.entries(o.$instance.methods))-1==i.indexOf(e)&&"function"==typeof t&&(i.push(e),r.push(t));if(n){const e=function(){const e=t?Object.keys(t):[];for(let t=0;t<i.length;t++)-1==e.indexOf(i[t])&&"function"!=typeof arguments[t]&&(o[i[t]]=arguments[t])};i.push("$update"),r.push(e)}let s,a="";n?(a+="{"+e+"}",a+="$update("+i.join(",")+");"):a+="return ("+e+");";try{s=new Function(...[...i,a])}catch(e){throw o.log.error("Failed to compile script: "+e.message),e}try{return s.apply(o,r)}catch(e){throw o.log.error("Script execution failed: "+e.message),e}}catch(e){o.log.error(e)}}commit(e){let t=this;if("object"==typeof e)for(const[n,o]of Object.entries(e))t.$vNode.$bindings[n]=o;t.compute(),t.render()}}class VComponent{constructor({id:e,createInstance:t,templateID:n}){let o=this;if(o.$id=Values.toString(e,"").trim(),!o.$id)throw new Error("The component-id must be specified.");if(o.$createInstance=t,"function"!=typeof o.$createInstance)throw new Error("The createInstance function must be specified.");o.$templateID=Values.toString(n,"").trim(),o.$templateID||(o.$templateID=void 0)}get id(){return this.$id}get templateID(){return this.$templateID}createInstance(e){return this.$createInstance(e)}}export class VDOM{static createApp(e,t){let n;if("string"==typeof t){const e=t;if(!VDOM.hasComponent(e))throw Error("The specified instance cannot be found: "+e);n=VDOM.getComponent(e)}for(const o of document.querySelectorAll(e)){if(o.nodeType!=Node.ELEMENT_NODE)continue;new VApp(o,n?n.createInstance():t).init()}}static addComponent(e){return!VDOM.hasComponent(e.id)&&(vComponents[e.id]=new VComponent(e),!0)}static hasComponent(e){return null!=VDOM.getComponent(e)}static getComponent(e){return vComponents[e]}static removeComponent(e){delete vComponents[e]}}